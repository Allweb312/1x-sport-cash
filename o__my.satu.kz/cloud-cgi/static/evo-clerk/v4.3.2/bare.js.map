{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./js/tools.js","webpack:///./js/bare.js","webpack:///./js/queue.js","webpack:///./js/metrics.js","webpack:///./js/base64.js","webpack:///./js/transport.js","webpack:///./js/stats.js","webpack:///./js/error.js","webpack:///./js/features.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","stub","win","window","consoleMock","error","debug","chars","charNum","length","cryptoApi","crypto","msCrypto","safeLocalStorage","localStorage","setItem","removeItem","e","getSafeLocalStorage","console","getUrl","location","href","split","genId","prefix","buf","ts","Date","charAt","Uint32Array","getRandomValues","maxVal","Math","pow","push","random","identifyClient","cid","getItem","stored","isNonEmpty","cleanObject","obj","keys","reduce","acc","JSON","stringify","toString","ClerkStats","require","clerkStats","CLERK_CONFIG","Queue","callback","timeout","this","events","timer","isStarted","event","pushWithFlush","setTimeout","flush","start","stop","chunk","splice","clearTimeout","par","parent","perf","performance","defaultActivity","category","action","focus_time","idle_time","Metrics","reset","attachListeners","fromDate","fetchStart","metrics","timing","lastFocus","lastBlur","load_start","addEventListener","domContentLoadedEventStart","loadEventStart","dom_loaded","page_loaded","page_unload","idleTime","focusTime","uint6ToB64","nUint6","str","aBytes","nMod3","eqLen","sB64Enc","nLen","nUint24","nIdx","String","fromCharCode","substring","bytesToBase64","string","codePoint","leadSurrogate","bytes","charCodeAt","Error","utf8ToBytes","xhr","endpoint","payload","err","XMLHttpRequest","onerror","details","type","target","status","statusText","open","send","transportFactory","url","rawPayload","base64Encoder","beaconAccepted","navigator","sendBeacon","beacon","doc","document","sendInfo","response","postMessage","clerk","requestPageInfo","getElementById","contentWindow","request","config","oldData","undefined","Array","isArray","DEBUG","pageInfo","cachedDimensions","endpointUrl","mirrorDimensions","eventMethod","activityMethod","pageviewMethod","fingerprintMethod","apeironSchema","infoCallback","baseURL","errorMessage","exceptionInfo","code","pageId","page_id","stack","Image","src","_","errorHandlerFactory","activityTransport","senderFactory","eventTransport","fingerprintTransport","pageviewTransport","queue","initialize","activity","forEach","force","message","kind","processPageview","pushEvent","pushFingerprint","extendPageInfo","dimensions","project","commonDimensions","pushPageview","ev","fp","fingerprint","features","result","scr","screen","screen_vp","availWidth","availHeight","screen_res","width","height","body","window_size","clientWidth","clientHeight","nav","java","mimeTypes","enabledPlugin","flashplug","plugins","flash","description","has_beacon","has_cors","detectFeatures","$","referrer","page_info","clerk_version","VERSION","transport","addCommonDimensions","eventsList","pageInfoPayload","client_id","commonDimensionsPayload","common_dimensions","data"],"mappings":"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","file":"bare.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 1);\n","/* eslint-disable no-plusplus,no-bitwise */\nconst stub = () => {};\nconst win = window;\nconst consoleMock = {\n    error: stub,\n    debug: stub\n};\n\nconst chars = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';\nconst charNum = chars.length;\nconst cryptoApi = win.crypto || win.msCrypto;\n\nexport const safeLocalStorage = getSafeLocalStorage();\nexport const console = win.console || consoleMock;\nexport const toSeconds = (ms) => ms / 1000;\nexport const getUrl = () => win.location.href.split('#')[0];\n\n// WARNING: There is some code, that relies on generated ID (including prefix)\n// to be less than 36 bytes. We currently generate shorter IDs.\n//\n// For the record: the failure was in prom.ua with client ids (so page ids\n// are probably safe). Still other places and projects may be influenced too\n// (especially ones derived from prom)\n//\nexport function genId(prefix) {\n    let ts = +new Date();\n    let buf;\n    for(let i = 0; i < 7; ++i) {\n        prefix += chars.charAt(ts % charNum);\n        ts = (ts / charNum) | 0;\n    }\n    if(cryptoApi) {\n        prefix += 'C';\n        buf = new Uint32Array(6);\n        cryptoApi.getRandomValues(buf);\n    } else {\n        prefix += 'R';\n        const maxVal = Math.pow(charNum, 4);\n        buf = [];\n        for(let i = 0; i < 6; ++i) {\n            // Getting about 24bits from every Math.random\n            // See http://bit.ly/1N9zygT\n            // It's safer than getting only 6 bits\n            //\n            // It's still bad, so we rely on 'crypto' being available\n            // in most browsers\n            buf.push((Math.random() * maxVal) | 0);\n        }\n    }\n    // Beware length restrictions! (see comment above)\n    for (let i = 0, r; i < 22; ++i) {\n        if ((i & 3) === 0) {\n            r = buf[i >> 2];\n        }\n        prefix += chars.charAt(r % charNum);\n        r = (r / charNum) | 0;\n    }\n    return prefix;\n}\n\nexport function identifyClient() {\n    if(safeLocalStorage) {\n        let cid = safeLocalStorage.getItem('clerk.client_id');\n        if(cid === null) {\n            cid = genId('c-');\n            if(DEBUG) {\n                console.debug(`CLERK IFRAME: No client id. Generated ${cid}`);\n            }\n            try {\n                safeLocalStorage.setItem('clerk.client_id', cid);\n            } catch(e) {\n                console.error('E006: Exception when storing client id in localStorage', e);\n            }\n            let stored = safeLocalStorage.getItem('clerk.client_id');\n            if(stored !== cid) {\n                console.error('E007: Stored value differs from what we tried');\n                if(stored) {\n                    // We assume that this is a race condition,\n                    // i.e. other page already stored it's client id\n                    // so we reuse that id\n                    return [stored, false];\n                } else {\n                    // Something wrong with storing ID, probably localStorage\n                    // is disabled/failing/safari bug\n                    return [cid, true];\n                }\n            } else {\n                return [cid, true];\n            }\n        } else {\n            if(DEBUG) {\n                console.debug(`CLERK IFRAME: Client id: ${cid}`);\n            }\n            return [cid, false];\n        }\n    } else {\n        // We assume that localStorage doesn't work, the user is new\n        // This situation is similar to disabled cookies, anonymous mode and\n        // so on, so probably it's okay\n        //\n        // In any case you can detect this kind of situation with `t-` prefix\n        console.error('E005: The localStorage is not supported');\n        return [genId('t-'), true];\n    }\n}\n\nexport function isNonEmpty(value) {\n    return (value !== null) && (value !== undefined);\n}\n\nexport function cleanObject(obj) {\n    return Object.keys(obj).reduce((acc, key) => {\n        const value = obj[key];\n        if (isNonEmpty(value)) {\n            acc[key] = typeof value === 'object' ? JSON.stringify(value) : value.toString();\n        }\n        return acc;\n    }, {});\n}\n\nexport function getSafeLocalStorage() {\n    /* eslint-disable no-storage/no-browser-storage */\n    try {\n        window.localStorage.setItem('___some_test___', 42);\n        window.localStorage.removeItem('___some_test___');\n        return window.localStorage;\n    } catch (e) {\n        return null;\n    }\n}\n","const win = window;\n\nlet ClerkStats;\nif(DEBUG) {\n    ClerkStats = require('./test').DebugClerkStats;\n} else {\n    ClerkStats = require('./stats').ClerkStats;\n}\nwin.clerkStats = new ClerkStats(win.CLERK_CONFIG, win.clerkStats);\n\n\n","import { console } from './tools';\n\n/**\n * @typedef {object.<string, string>} ClerkEvent\n * @property {string} category Event category\n * @property {string} action Event action\n *\n * May contain arbitrary string fields\n **/\n\n\n/**\n * @classdesc Event queue\n */\nexport class Queue {\n    /**\n     * Flushable event queue\n     *\n     * @param {function} callback\n     * @param {number} timeout\n     * @constructs\n     */\n    constructor(callback, timeout) {\n        this.callback = callback;\n        this.events = [];\n        this.timer = null;\n        this.isStarted = false;\n        this.timeout = timeout;\n    }\n\n    /**\n     * Push single event to queue\n     *\n     * @param {ClerkEvent} event\n     */\n    push(event) {\n        this.events.push(event);\n    }\n    pushWithFlush(event) {\n        this.push(event);\n        if (this.isStarted && !this.timer) {\n            this.timer = setTimeout(::this.flush, this.timeout);\n        }\n    }\n    start() {\n        this.isStarted = true;\n        this.flush();\n        if(DEBUG) {\n            console.debug('CLERK: Started queue');\n        }\n    }\n    stop() {\n        this.isStarted = false;\n        this.flush();\n        if(DEBUG) {\n            console.debug('CLERK: Stopped queue');\n        }\n    }\n    flush() {\n        if (!this.events.length) return;\n\n        const chunk = this.events.splice(0, this.events.length);\n        if(this.timer) {\n            clearTimeout(this.timer);\n            this.timer = null;\n        }\n        if(chunk.length) {\n            this.callback(chunk);\n        }\n    }\n}\n","/* eslint-disable camelcase */\nimport {console, toSeconds} from './tools';\n\nconst par = window.parent;\nconst perf = par.performance;\n\n/**\n * @typedef {object} ActivityPayload\n * @property {string} category Event category, always \"clerk\"\n * @property {string} action Event action, always \"activity\"\n * @property {number} focus_time time spent on the page when it is in focus\n * @property {number} idle_time Inactivity time of the page\n * @property {number} [load_start] start timestamp of page loading\n * @property {number} [dom_loaded] duration of loading the page DOM tree\n * @property {number} [page_loaded] duration of loading the entire page content\n * @property {number} [page_unload] time from the start of the page loading to its unloading\n *\n **/\n\n/**\n * @type ActivityPayload\n * @access private\n **/\nconst defaultActivity = {\n    category: 'clerk',\n    action: 'activity',\n    focus_time: 0,\n    idle_time: 0\n};\n\n/**\n * @classdesc Metrics class\n */\nexport class Metrics {\n    constructor() {\n        if (!par.performance) {\n            if (DEBUG) {\n                console.error('E004: Web Performance API unavailable');\n            }\n            return;\n        }\n        this.reset();\n        this.attachListeners();\n        if (DEBUG) {\n            console.debug(`CLERK: Page loading begins at ${new Date(this.metrics.load_start)}`);\n        }\n    }\n\n    /**\n     * Return current performance and activity metrics\n     *\n     * @return {ActivityPayload}\n     */\n    get activity() {\n        return this.metrics;\n    }\n\n    /**\n     * Resets all collected performance metrics\n     *\n     * @param {boolean} [fromDate] Use Date as source of start time; instead, use performance API\n     * @return {void}\n     */\n    reset(fromDate=false) {\n        this.metrics = Object.assign({}, defaultActivity);\n        let fetchStart;\n        if (fromDate) {\n            fetchStart = +new Date();\n        } else {\n            fetchStart = perf.timing.fetchStart;\n        }\n        this.lastFocus = fetchStart;\n        this.lastBlur = fetchStart;\n        this.fetchStart = fetchStart;\n        this.metrics.load_start = fetchStart;\n        if (DEBUG) {\n            console.debug('CLERK: Metrics initialized', this.metrics);\n        }\n    }\n\n    /**\n     * Attach measuring listeners to parent window\n     *\n     * @return {void}\n     */\n    attachListeners() {\n        par.addEventListener('load', () => {\n            const {timing: {domContentLoadedEventStart, loadEventStart}} = perf;\n\n            this.metrics.dom_loaded = domContentLoadedEventStart - this.fetchStart;\n            if (DEBUG) {\n                console.debug(`CLERK: DOM loaded took ${toSeconds(this.metrics.dom_loaded)} seconds`);\n            }\n\n            this.metrics.page_loaded = loadEventStart - this.fetchStart;\n            if (DEBUG) {\n                console.debug(`CLERK: Entire page loaded in ${toSeconds(this.metrics.page_loaded)} seconds`);\n            }\n        });\n\n        par.addEventListener('beforeunload', () => {\n            this.metrics.page_unload = +new Date() - this.fetchStart;\n            if (DEBUG) {\n                console.debug('CLERK: Collected metrics', this.metrics);\n            }\n        });\n\n        par.addEventListener('focus', () => {\n            if (!this.lastBlur) return;\n\n            this.lastFocus = +new Date();\n            let idleTime = this.lastFocus - this.lastBlur;\n            this.lastBlur = null;\n\n            this.metrics.idle_time += idleTime;\n\n            if (DEBUG) {\n                console.debug(`CLERK: ${toSeconds(idleTime)} seconds to idle time`);\n            }\n        });\n\n        par.addEventListener('blur', () => {\n            if (!this.lastFocus) return;\n\n            this.lastBlur = +new Date();\n            let focusTime = this.lastBlur - this.lastFocus;\n            this.lastFocus = null;\n\n            this.metrics.focus_time += focusTime;\n\n            if (DEBUG) {\n                console.debug(`CLERK: ${toSeconds(focusTime)} seconds to active time`);\n            }\n        });\n    }\n}\n","/* eslint-disable no-bitwise,no-mixed-operators,no-plusplus,no-continue */\n/*\n * Base64 encoder\n * Code borrowed from:\n *      https://github.com/feross/buffer\n *      https://github.com/madmurphy/stringview.js\n */\n\nfunction uint6ToB64(nUint6) {\n    if (nUint6 < 26) {\n        return nUint6 + 65;\n    } else if (nUint6 < 52) {\n        return nUint6 + 71;\n    } else if (nUint6 < 62) {\n        return nUint6 - 4;\n    } else if (nUint6 === 62) {\n        return 43;\n    } else if (nUint6 === 63) {\n        return 47;\n    } else {\n        return 65;\n    }\n}\n\nfunction bytesToBase64(aBytes) {\n    const eqLen = (3 - (aBytes.length % 3)) % 3;\n    let sB64Enc = '';\n\n    for (\n        let nMod3, nLen = aBytes.length, nUint24 = 0, nIdx = 0;\n        nIdx < nLen;\n        nIdx++\n    ) {\n        nMod3 = nIdx % 3;\n        nUint24 |= aBytes[nIdx] << (16 >>> nMod3 & 24);\n        if (nMod3 === 2 || aBytes.length - nIdx === 1) {\n            sB64Enc += String.fromCharCode(\n                uint6ToB64(nUint24 >>> 18 & 63),\n                uint6ToB64(nUint24 >>> 12 & 63),\n                uint6ToB64(nUint24 >>> 6 & 63),\n                uint6ToB64(nUint24 & 63)\n            );\n            nUint24 = 0;\n        }\n    }\n\n    if (eqLen === 0) {\n        return sB64Enc;\n    } else {\n        return (\n            sB64Enc.substring(0, sB64Enc.length - eqLen)\n            + (eqLen === 1 ? '=' : '==')\n        );\n    }\n}\n\nfunction utf8ToBytes(string) {\n    let codePoint;\n    let length = string.length;\n    let leadSurrogate = null;\n    let bytes = [];\n    let i = 0;\n    for (; i < length; i++) {\n        codePoint = string.charCodeAt(i);\n        // is surrogate component\n        if (codePoint > 0xD7FF && codePoint < 0xE000) {\n            // last char was a lead\n            if (leadSurrogate) {\n                // 2 leads in a row\n                if (codePoint < 0xDC00) {\n                    bytes.push(0xEF, 0xBF, 0xBD);\n                    leadSurrogate = codePoint;\n                    continue;\n                } else {\n                    // valid surrogate pair\n                    codePoint = (\n                        leadSurrogate - 0xD800 << 10\n                        | codePoint - 0xDC00 | 0x10000\n                    );\n                    leadSurrogate = null;\n                }\n            } else {\n                // no lead yet\n                if (codePoint > 0xDBFF) {\n                    // unexpected trail\n                    bytes.push(0xEF, 0xBF, 0xBD);\n                    continue;\n                } else if (i + 1 === length) {\n                    // unpaired lead\n                    bytes.push(0xEF, 0xBF, 0xBD);\n                    continue;\n                } else {\n                    // valid lead\n                    leadSurrogate = codePoint;\n                    continue;\n                }\n            }\n        } else if (leadSurrogate) {\n            // valid bmp char, but last char was a lead\n            bytes.push(0xEF, 0xBF, 0xBD);\n            leadSurrogate = null;\n        }\n        // encode utf8\n        if (codePoint < 0x80) {\n            bytes.push(codePoint);\n        } else if (codePoint < 0x800) {\n            bytes.push(\n                codePoint >> 0x6 | 0xC0,\n                codePoint & 0x3F | 0x80\n            );\n        } else if (codePoint < 0x10000) {\n            bytes.push(\n                codePoint >> 0xC | 0xE0,\n                codePoint >> 0x6 & 0x3F | 0x80,\n                codePoint & 0x3F | 0x80\n            );\n        } else if (codePoint < 0x200000) {\n            bytes.push(\n                codePoint >> 0x12 | 0xF0,\n                codePoint >> 0xC & 0x3F | 0x80,\n                codePoint >> 0x6 & 0x3F | 0x80,\n                codePoint & 0x3F | 0x80\n            );\n        } else {\n            throw new Error('Invalid code point');\n        }\n    }\n    return bytes;\n}\n\nexport default (str) => bytesToBase64(utf8ToBytes(str));","/**\n * @typedef {function} Transport\n * @param {object.<string, string>} payload\n * @param {ErrorHandler} [err] Error callback\n * @return {boolean} Success flag\n */\n\nimport base64Encoder from './base64';\n\n/**\n * Send request via plain XHR\n *\n * @see {@link https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest|MDN doc}\n * @param {string} endpoint\n * @param {object.<string, string>} payload\n * @param {ErrorHandler} [err] Error callback\n * @return {boolean} Success flag\n */\nfunction xhr(endpoint, payload, err) {\n    try {\n        const xhr = new XMLHttpRequest();\n        xhr.onerror = (e) => {\n            const msg = 'E012: Error sending POST xhr';\n            const details = `${e.type}:${e.name}:${e.target.status}:${e.target.statusText}`;\n            return err(msg, details);\n        };\n        xhr.open('POST', endpoint, true);\n        xhr.send(payload);\n        return true;\n    } catch (e) {\n        if (err) err('E013: POST request could not be delivered', e);\n        return false;\n    }\n}\n\n/**\n * Send request via Beacon API\n *\n * @see {@link https://www.w3.org/TR/beacon/#sec-sendBeacon-method|W3C Docs}\n * @param {string} endpoint\n * @param {object.<string, string>} payload\n * @param {ErrorHandler} [err] Error callback\n * @return {boolean} Success flag\n */\nfunction beacon(endpoint, payload, err) {\n    try {\n        if ((typeof navigator.sendBeacon) === 'function') {\n            return navigator.sendBeacon(endpoint, payload);\n        }\n    } catch (e) {\n        if (err) err('E018: Error sending beacon request', e);\n        return false;\n    }\n}\n\n/**\n * Transport function factory\n *\n * @param {string} url\n * @return {Transport} Sender function, tied to proper endpoint\n */\nexport default function transportFactory(url) {\n    /**\n     * Transport function\n     */\n    function transport(rawPayload, err) {\n        const payload = base64Encoder(JSON.stringify(rawPayload));\n        let beaconAccepted = true;\n        if (beaconAccepted) {\n            beaconAccepted = beacon(url, payload, err);\n            if (!beaconAccepted) {\n                // Downgrade to XHR and retry failed request\n                return xhr(url, payload, err);\n            }\n            return true;\n        } else {\n            return xhr(url, payload, err);\n        }\n    }\n\n    return transport;\n}\n","/**\n * @typedef {function} Sender\n * @param {Array.<ClerkEvent>} eventsList\n * @return {boolean} Success flag\n */\n/**\n * @typedef {object.<string, string>} Dimensions\n * @property {string} [project] Project of page\n */\n\nimport detectFeatures from './features';\nimport { Queue } from './queue';\nimport { Metrics } from './metrics';\nimport {console, getUrl, cleanObject, isNonEmpty} from './tools';\nimport transportFactory from './transport';\nimport errorHandlerFactory from './error';\n\nlet validateDimensions;\nif (DEBUG) {\n    validateDimensions = require('./apeiron').validateDimensions;\n}\n\nconst win = window;\nconst doc = win.document;\n\n\n/**\n * Send page info to subscribers\n *\n * @param {PageInfo} response Page information, received from iframe\n * @access private\n * @static\n */\nfunction sendInfo(response) {\n    if (DEBUG) {\n        console.debug('CLERK: Send info', response);\n    }\n    win.postMessage({clerk: {response}}, '*');\n}\n\n/**\n * Request new page info from iframe\n *\n * @access private\n * @static\n */\nfunction requestPageInfo() {\n    if (DEBUG) {\n        console.debug('CLERK: Requested page info from iframe');\n    }\n    doc.getElementById('clerk_iframe').contentWindow.postMessage({clerk: {request: 'getPageInfo'}}, '*');\n}\n\n/**\n * @classdesc Clerk class\n */\nexport class ClerkStats {\n    constructor(config, oldData) {\n        if(config === undefined) {\n            console.error('E001: No Clerk configuration found');\n            return;\n        }\n        if(!Array.isArray(oldData)) {\n            console.error('E002: No data or two Clerks loaded');\n            return;\n        }\n        if(DEBUG) {\n            console.debug('CLERK: Initialized', VERSION);\n            console.debug(config);\n            if (oldData.length) {\n                console.debug('CLERK: Early enqueued events', oldData);\n            }\n        }\n\n        this.push = ::this.push;\n        /** @type {PageInfo|null} */\n        this.pageInfo = null;\n        /** @type {Dimensions|null} */\n        this.cachedDimensions = null;\n\n        const {\n            endpointUrl,\n            mirrorDimensions = [],\n            eventMethod = null,\n            activityMethod = null,\n            pageviewMethod = null,\n            fingerprintMethod = null,\n            apeironSchema = null,\n        } = config;\n\n        this.mirrorDimensions = mirrorDimensions;\n\n        if (DEBUG) {\n            /** @type {ApeironSchema|null} */\n            this.apeironSchema = apeironSchema;\n        }\n\n        const infoCallback =  () => this.pageInfo;\n\n        this.error = errorHandlerFactory(endpointUrl, infoCallback);\n\n        this.activityTransport = ::this.senderFactory(\n            transportFactory(`${endpointUrl}/${activityMethod || 'activity'}`),\n            this.error,\n            infoCallback,\n            false,\n        );\n\n        this.eventTransport = ::this.senderFactory(\n            transportFactory(`${endpointUrl}/${eventMethod || 'events'}`),\n            this.error,\n            infoCallback,\n            true,\n        );\n\n        this.fingerprintTransport = ::this.senderFactory(\n            transportFactory(`${endpointUrl}/${fingerprintMethod || 'fingerprints'}`),\n            this.error,\n            infoCallback,\n            true,\n        );\n\n        this.pageviewTransport = transportFactory(`${endpointUrl}/${pageviewMethod || 'pageviews'}`);\n\n        this.queue = new Queue(::this.eventTransport, 150);\n        this.metrics = new Metrics();\n\n        this.initialize();\n\n        win.addEventListener('beforeunload', () => {\n            this.queue.flush();\n            this.activityTransport([this.metrics.activity]);\n        });\n\n        oldData.forEach((event) => this.push(event));\n    }\n\n    /**\n     * Main method to push arbitrary data to Clerk\n     *\n     * @param {object.<string, string>} obj Generic Clerk event\n     * @param {boolean} [force=false] Should be event omit queue and push directly into transport?\n     * @return {void}\n     */\n    push(obj, force=false) {\n        let message = 'E003: Push error';\n        try {\n            const kind = obj._;\n            delete obj._;\n            switch(kind) {\n                case 'pageview':\n                    message = 'E031: Error sending pageview';\n                    this.processPageview(obj);\n                    break;\n\n                case 'event':\n                    message = 'E032: Error sending event';\n                    this.pushEvent(obj, force);\n                    break;\n\n                case 'notify':\n                    message = 'E033: Error sending notification';\n                    obj['non_interaction'] = '1';\n                    this.pushEvent(obj, force);\n                    break;\n\n                case 'fingerprint':\n                    message = 'E034 Error sending fingerprint';\n                    this.pushFingerprint(obj);\n                    break;\n\n                default:\n                    message = 'E030: Invalid kind';\n                    this.error(message, JSON.stringify(obj));\n                    return;\n            }\n        } catch(e) {\n            this.error(message, e);\n            if (DEBUG) {\n                console.error('CLERK: Failed to process', JSON.stringify(obj));\n            }\n        }\n    }\n\n    /**\n     * Extend page info with dimensions from pageview\n     *\n     * @param {Dimensions} dimensions Dimensions from pageview\n     * @return {void}\n     */\n    extendPageInfo(dimensions) {\n        this.pageInfo.project = dimensions.project;\n        this.pageInfo.commonDimensions = this.mirrorDimensions.reduce((acc, key) => {\n            const value = dimensions[key];\n            if (isNonEmpty(value)) {\n                acc[key] = typeof value === 'object' ? JSON.stringify(value) : value.toString();\n            }\n            return acc;\n        }, {});\n    }\n\n    /**\n     * Process pageviews\n     *\n     * @param {Dimensions|null} [dimensions] Dimensions for pageview\n     * @return {void}\n     */\n    processPageview(dimensions) {\n        if(this.pageInfo) { // There are already stored message from iframe\n            if (this.cachedDimensions) { // there are pageview in cache\n                if (dimensions) {\n                    this.error('E050: Dimensions conflict');\n                    return;\n                }\n                if (DEBUG) {\n                    console.debug('CLERK: Processing cached dimensions');\n                }\n                this.pushPageview(this.cachedDimensions);\n                this.extendPageInfo(this.cachedDimensions);\n                this.cachedDimensions = null;\n                this.queue.start();\n            } else if (dimensions) {\n                if (this.queue.isStarted) {\n                    if (DEBUG) {\n                        console.debug('CLERK: Initiated new pageview');\n                    }\n                    this.activityTransport([this.metrics.activity]);\n                    this.metrics.reset(true);\n                    this.queue.stop();\n                    this.pageInfo = null;\n                    this.cachedDimensions = dimensions;\n                    requestPageInfo();\n                } else {\n                    if (DEBUG) {\n                        console.debug('CLERK: Processing received dimensions');\n                    }\n                    this.pushPageview(dimensions);\n                    this.extendPageInfo(dimensions);\n                    this.queue.start();\n                }\n            } else if (DEBUG) {\n                console.debug('CLERK: Dimensions are not received yet, skipping page_info');\n            }\n        } else {\n            if (this.cachedDimensions) {\n                this.error('E051: Malformed pageview state');\n                return;\n            }\n            if (!dimensions) {\n                this.error('E052: Empty pageview state');\n                return;\n            }\n            if (DEBUG) {\n                console.debug('CLERK: Caching pageview for later processing');\n            }\n            this.cachedDimensions = dimensions;\n        }\n    }\n\n    /**\n     * Verify and push event to tracking system\n     *\n     * @param {ClerkEvent} ev Clerk event\n     * @param {boolean} force Should be event omit queue and push directly into transport?\n     * @return {void}\n     */\n    pushEvent(ev, force) {\n        const event = cleanObject(ev);\n        const {category, action} = event;\n\n        if (!category) {\n            this.error('E041: No category in event');\n            return;\n        }\n        if (!action) {\n            this.error('E041: No action in event');\n            return;\n        }\n        if (DEBUG) {\n            console.debug(`CLERK: ${force ? 'Forcing' : 'Queuing'} event ${category}:${action}`, event);\n        }\n\n        if (this.pageInfo && force) {\n            this.eventTransport([event]);\n        } else if (this.pageInfo && !force) {\n            this.queue.pushWithFlush(event);\n        } else {\n            this.queue.push(event);\n        }\n    }\n\n    /**\n     * Verify and push fingerprint to tracking system\n     *\n     * @param {ClerkEvent} fp fingerprint\n     * @return {void}\n     */\n    pushFingerprint(fp) {\n        if (Object.keys(fp.fingerprint).length === 0) {\n            this.error('E061: Empty fingerprint passed', fp.fingerprint);\n            return;\n        }\n        if (!fp.category) {\n            this.error('E062: No category in event');\n            return;\n        }\n        if (!fp.action) {\n            this.error('E063: No action in event');\n            return;\n        }\n        const fingerprint = cleanObject(fp, ['fingerprint']);\n        if (DEBUG) {\n            console.debug(`CLERK: sending fingerprint`, fingerprint);\n        }\n        if (this.pageInfo) {\n            this.fingerprintTransport([fingerprint]);\n        }\n    }\n\n    /**\n     * Construct and push pageview event to tracking system\n     *\n     * @param {Dimensions} dimensions user-provided dimensions for pageview\n     * @return {void}\n     * @see Dimensions\n     */\n    pushPageview(dimensions) {\n        const features = {};\n        try {\n            Object.assign(features, detectFeatures());\n        } catch (e) {\n            this.error('E010: Error detecting browser features', e);\n        }\n        const { url=null , referrer=null } = dimensions.$ || {};\n        delete dimensions.$;\n        const payload = {\n            url: url || getUrl(),\n            referrer: referrer || doc.referrer,\n            page_info: this.pageInfo,  // eslint-disable-line camelcase\n            features,\n            dimensions: Object.assign(\n                { clerk_version: VERSION }, // eslint-disable-line camelcase\n                cleanObject(dimensions)\n            ),\n        };\n\n        if (DEBUG) {\n            if (this.apeironSchema) {\n                const errors = validateDimensions(this.apeironSchema, 'pageviews', payload.dimensions);\n                if (errors.length > 0) {\n                    this.error(\n                        'E053: Cannot send pageview, dimension or ab_test code not in Apeiron schema. ' +\n                        'Please update schema @ https://apeiron.stg.evo and reload this page.',\n                        errors\n                    );\n                    return;\n                }\n            }\n\n            console.debug('CLERK: Sending pageview', payload);\n        }\n\n        this.pageviewTransport(payload, this.error);\n    }\n\n    /**\n     * Sender factory for different event types\n     *\n     * @param {Transport} transport Preferred transport to send payloads\n     * @param {ErrorHandler} [err] Error callback\n     * @param {InfoCallback} infoCallback\n     * @param {boolean} addCommonDimensions\n     * @return {Sender} function, ready to process clerk events\n     * @see transportFactory Transport factory docstring\n     */\n    senderFactory(transport, err, infoCallback, addCommonDimensions) {\n        /**\n         * Send list of events to tracking endpoint\n         */\n        function sender(eventsList) {\n            const pageInfo = infoCallback();\n            const pageInfoPayload = {\n                project: pageInfo.project,\n                client_id: pageInfo.client_id, // eslint-disable-line camelcase\n                page_id: pageInfo.page_id, // eslint-disable-line camelcase\n                events: eventsList,\n            };\n            const commonDimensionsPayload = addCommonDimensions ? {\n                common_dimensions: Object.assign({}, pageInfo.commonDimensions), // eslint-disable-line camelcase\n            } : {};\n            const payload = Object.assign({}, pageInfoPayload, commonDimensionsPayload);\n\n            if (DEBUG) {\n                if (this.apeironSchema) {\n                    let mergedEvents = Object.assign({}, ...eventsList);\n                    if (addCommonDimensions) {\n                        Object.assign(mergedEvents, pageInfo.commonDimensions);\n                    }\n                    const errors = validateDimensions(this.apeironSchema, 'events', mergedEvents);\n                    if (errors.length > 0) {\n                        this.error(\n                            'E054: Cannot send events, dimension or ab_test code not in Apeiron schema. ' +\n                            'Please update schema @ https://apeiron.stg.evo and reload this page.',\n                            errors\n                        );\n                        return false;\n                    }\n                }\n                console.debug(`CLERK: Sending ${eventsList.length} events:`, payload);\n            }\n\n            return transport(payload, err);\n        }\n\n        return sender;\n    }\n\n    /**\n     * Initializes clerk by attaching event listener and requesting page info from iframe\n     * Literally it is main entry point to kick off entire tracking system\n     */\n    initialize() {\n        win.addEventListener('message', ({data}) => {\n            const {clerk} = data;\n            if(clerk && clerk.pageInfo) {\n                // Set page info from iframe\n                if (this.pageInfo === null) {\n                    if (DEBUG) {\n                        console.debug('CLERK: Received pageInfo from iframe', clerk.pageInfo);\n                    }\n                    this.pageInfo = clerk.pageInfo;\n                    sendInfo(this.pageInfo);\n                } else {\n                    if (DEBUG) {\n                        console.debug('CLERK: Skip redundant pageInfo', clerk.pageInfo);\n                    }\n                }\n                // Try to process pageview\n                this.processPageview();\n            }\n        });\n\n        win.addEventListener('message', ({data}) => {\n            const {clerk} = data;\n            if(clerk && clerk.request && clerk.request === 'getInfo' && this.pageInfo !== null) {\n                if(DEBUG) {\n                    console.debug('CLERK: Got getInfo request');\n                }\n                sendInfo(this.pageInfo);\n            }\n        });\n\n        requestPageInfo();\n    }\n}\n","import { console } from './tools';\nimport base64Encoder from './base64';\n\n/**\n * @typedef {function} ErrorHandler\n * @param {string} reason String, represents error\n * @param {object|string} [exception] Exception object\n * @return {void}\n */\n\n/**\n * @typedef {function} InfoCallback\n * @return {PageInfo|null}\n */\n\n/**\n * Error handler factory\n *\n * @param {string} baseURL\n * @param {InfoCallback} infoCallback\n * @return {ErrorHandler} Default error handler\n */\nexport default function errorHandlerFactory(baseURL, infoCallback) {\n    function defaultErrorHandler(errorMessage, exceptionInfo) {\n        const pageInfo = infoCallback();\n        const endpoint = `${baseURL}/err.gif`;\n        try {\n            const code = errorMessage.split(':')[0];\n            const pageId = pageInfo && pageInfo.page_id;\n            let details;\n            if (exceptionInfo instanceof Error) {\n                details = exceptionInfo.stack || exceptionInfo.toString();\n            } else {\n                details = `${exceptionInfo}`;\n            }\n\n            new Image().src = endpoint\n                + `?w=${code}`\n                + (pageId ? `&p=${pageId}` : '')\n                + (details ? `&e=${base64Encoder(details)}` : '');\n\n            console.error(errorMessage, exceptionInfo);\n        } catch (_) {} //eslint-disable-line no-empty\n    }\n    return defaultErrorHandler;\n}\n","/* eslint-disable camelcase */\n\n/**\n * @typedef {object.<string, string|boolean>} Features\n * @property {string} screen_vp Viewport size (width  height)\n * @property {string} screen_res Screen resolution (width  height)\n * @property {string} window_size Window size (width  height)\n * @property {string} [java] Java version, if present\n * @property {string} [flash] Flash version, if present\n * @property {boolean} has_beacon Beacon API presence\n * @property {boolean} has_cors CORS presence\n **/\n\n/**\n * Detects various features of user agent\n *\n * @returns {Features}\n */\nexport default function detect() {\n    const result = {};\n    const scr = screen;\n    result.screen_vp = scr.availWidth + 'x' + scr.availHeight;\n    result.screen_res = scr.width + 'x' + scr.height;\n\n    const body = document.body;\n    result.window_size = body.clientWidth + 'x' + body.clientHeight;\n\n    const nav = navigator;\n    const java = nav.mimeTypes && nav.mimeTypes['application/x-java-applet'];\n    if(java) {\n        result.java = java.enabledPlugin.name;\n    }\n    const flashplug = nav.plugins && nav.plugins['Shockwave Flash'];\n    if(flashplug) {\n        result.flash = flashplug.description;\n    }\n    result.has_beacon = (typeof nav.sendBeacon) === 'function';\n    result.has_cors = 'withCredentials' in new XMLHttpRequest();\n    return result;\n}\n"],"sourceRoot":""}